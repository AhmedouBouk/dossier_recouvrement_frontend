

<main class="main-content">
  <div class="container">
    <div class="actions-bar">
      <div class="search-container">
        <i class="material-icons">search</i>
        <input [(ngModel)]="searchTerm" placeholder="Rechercher par ID, Compte ou Statut" (keyup.enter)="searchCredits()">
      </div>
      <button *ngIf="authService.hasDODCRole" class="add-credit-btn" (click)="navigateToAdd()">
        <i class="material-icons">add_circle</i>
        Ajouter un Crédit
      </button>
    </div>

    <div class="table-container" *ngIf="credits.length > 0; else noCredits">
      <table>
        <thead>
          <tr>
            <th>ID Crédit</th>
            <th>ID Compte</th>
            <th>Montant</th>
            <th>Date Début</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let credit of credits">
            <td>{{ credit.idCredit }}</td>
            <td>{{ credit.compte?.nomCompte }}</td>
            <td>{{ credit.montant | currency:'EUR':'symbol':'1.0-0' }}</td>
            <td>{{ credit.dateDebut | date:'dd/MM/yyyy' }}</td>
            <td>
              <span class="status-chip" [ngClass]="getStatusClass(credit.statut)">
                {{ credit.statut }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="view-btn" (click)="viewDetails(credit)">
                  <i class="material-icons">visibility</i>
                  Détails
                </button>
                <button class="edit-btn" (click)="navigateToEdit(credit.idCredit)" *ngIf="authService.hasDODCRole">
                  <i class="material-icons">edit</i>
                  Modifier
                </button>
                <button class="delete-btn" (click)="deleteCredit(credit.idCredit)" *ngIf="authService.hasDODCRole">
                  <i class="material-icons">delete</i>
                  Supprimer
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #noCredits>
      <div class="no-credits-message">
        <i class="material-icons">credit_card_off</i>
        <p>Aucun crédit trouvé. Veuillez en ajouter un nouveau.</p>
      </div>
    </ng-template>
  </div>
</main>

<!-- Modal de détails -->
<div class="modal-overlay" *ngIf="selectedCredit" (click)="closeDetails()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Détails du Crédit</h2>
      <button class="close-btn" (click)="closeDetails()">
        <i class="material-icons">close</i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="details-grid">
        <div class="detail-item">
          <span class="label">ID Crédit</span>
          <span class="value">{{ selectedCredit.idCredit }}</span>
        </div>
        <div class="detail-item">
          <span class="label">ID Compte</span>
          <span class="value">{{ selectedCredit.idCompte }}</span>
        </div>
        <div class="detail-item">
          <span class="label">ID Garantie</span>
          <span class="value">{{ selectedCredit.idGarantie }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Montant</span>
          <span class="value">{{ selectedCredit.montant | currency:'EUR':'symbol':'1.0-0' }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Taux d'intérêt</span>
          <span class="value">{{ selectedCredit.tauxInteret }}%</span>
        </div>
        <div class="detail-item">
          <span class="label">Durée</span>
          <span class="value">{{ selectedCredit.duree }} mois</span>
        </div>
        <div class="detail-item">
          <span class="label">Date de début</span>
          <span class="value">{{ selectedCredit.dateDebut | date:'dd/MM/yyyy' }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Statut</span>
          <span class="value status-chip" [ngClass]="getStatusClass(selectedCredit.statut)">
            {{ selectedCredit.statut }}
          </span>
        </div>
        <div class="detail-item">
          <span class="label">Référence Transaction</span>
          <span class="value">{{ selectedCredit.refTransaction || 'Non spécifié' }}</span>
        </div>
      </div>

      <div class="documents-section">
        <h3>Documents associés</h3>
        <div class="documents-grid">
          <button class="document-btn" (click)="downloadFile('demande')">
            <i class="material-icons">description</i>
            <span>Demande</span>
          </button>
          <button class="document-btn" (click)="downloadFile('etude')">
            <i class="material-icons">analytics</i>
            <span>Étude</span>
          </button>
          <button class="document-btn" (click)="downloadFile('bulletinSalaire')">
            <i class="material-icons">receipt_long</i>
            <span>Bulletin de Salaire</span>
          </button>
          <button class="document-btn" (click)="downloadFile('domiciliation')">
            <i class="material-icons">home</i>
            <span>Domiciliation</span>
          </button>
          <button class="document-btn" (click)="downloadFile('pvComite')">
            <i class="material-icons">groups</i>
            <span>PV Comité</span>
          </button>
          <button class="document-btn" (click)="downloadFile('bonPourAval')">
            <i class="material-icons">verified</i>
            <span>Bon Pour Aval</span>
          </button>
          <button class="document-btn" (click)="downloadFile('reconnaissanceDeDette')">
            <i class="material-icons">gavel</i>
            <span>Reconnaissance de Dette</span>
          </button>
          <button class="document-btn" (click)="downloadFile('contrat')">
            <i class="material-icons">assignment</i>
            <span>Contrat</span>
          </button>
          <button class="document-btn" (click)="downloadFile('tableauAmortissement')">
            <i class="material-icons">table_chart</i>
            <span>Tableau d'Amortissement</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>