<div class="container">
  <div class="page-header">
    <div class="title">
      <i class="material-icons">people</i>
      <h2>Gestion des Clients</h2>
    </div>
  </div>

  <!-- Import Section -->
  <div *ngIf="roleService.hasEditPermission()" class="card-container">
    <div class="import-section">
      <div class="section-header">
        <h3>
          <i class="material-icons">upload_file</i>
          Importer des clients
        </h3>
        <div class="import-actions">
          <div class="file-input-wrapper">
            <input 
              type="file" 
              id="file-input"
              (change)="onFileSelected($event)" 
              accept=".csv"
              #fileInput>
            <label for="file-input" class="file-label" [class.has-file]="selectedFile">
              <i class="material-icons">{{ selectedFile ? 'check_circle' : 'file_upload' }}</i>
              <span>{{ selectedFile?.name || 'Choisir un fichier CSV' }}</span>
            </label>
          </div>
          <button 
            [disabled]="!selectedFile" 
            (click)="importClients()" 
            class="import-btn">
            <i class="material-icons">cloud_upload</i>
            {{ selectedFile ? 'Importer' : 'Sélectionner un fichier' }}
          </button>
        </div>
      </div>

      <!-- Alert Message -->
      <div *ngIf="importMessage" class="alert" [ngClass]="'alert-' + importMessage.type">
        <i class="material-icons">{{ importMessage.type === 'success' ? 'check_circle' : 'error' }}</i>
        {{ importMessage.text }}
      </div>
    </div>
  </div>

  <!-- Search Section -->
  <div class="card-container">
    <div class="search-section">
      <div class="search-grid">
        <div class="search-field">
          <div class="input-with-icon">
            <i class="material-icons">person</i>
            <input [(ngModel)]="searchNom" placeholder="Nom">
          </div>
        </div>
        <div class="search-field">
          <div class="input-with-icon">
            <i class="material-icons">person_outline</i>
            <input [(ngModel)]="searchPrenom" placeholder="Prénom">
          </div>
        </div>
        <div class="search-field">
          <div class="input-with-icon">
            <i class="material-icons">badge</i>
            <input [(ngModel)]="searchNNI" type="number" placeholder="NNI">
          </div>
        </div>
      </div>
      <button (click)="searchClients()" class="search-btn">
        <i class="material-icons">search</i>
        Rechercher
      </button>
    </div>

    <!-- Clients Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>NNI</th>
            <th>NIF</th>
            <th>Nom</th>
            <th>Prénom</th>
            <th>Date de Naissance</th>
            <th>Adresse</th>
            <th>Secteur d'Activité</th>
            <th>Genre</th>
            <th>Salaire</th>
            <th *ngIf="roleService.hasEditPermission()">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let client of clients">
            <!-- View Mode -->
            <ng-container *ngIf="editingClient?.nni !== client.nni">
              <td class="id-cell">{{client.nni}}</td>
              <td class="id-cell">{{client.nif}}</td>
              <td>{{client.nom}}</td>
              <td>{{client.prenom}}</td>
              <td>{{client.dateNaissance | date:'dd/MM/yyyy'}}</td>
              <td>{{client.adresse}}</td>
              <td>
                <span class="sector-badge">{{client.secteurActivite}}</span>
              </td>
              <td>
                <span class="gender-badge" [class]="client.genre.toLowerCase()">
                  {{client.genre}}
                </span>
              </td>
              <td class="amount">{{client.salaire | number:'1.2-2'}} MRU</td>
              <td *ngIf="roleService.hasEditPermission()" class="actions">
                <div class="action-buttons">
                  <button class="edit-btn" (click)="startEdit(client)">
                    <i class="material-icons">edit</i>
                    Modifier
                  </button>
                  <button class="delete-btn" (click)="deleteClient(client.nni)">
                    <i class="material-icons">delete</i>
                    Supprimer
                  </button>
                </div>
              </td>
            </ng-container>

            <!-- Edit Mode -->
            <ng-container *ngIf="editingClient?.nni === client.nni">
              <td class="id-cell">{{client.nni}}</td>
              <td class="id-cell">{{client.nif}}</td>
              <td>
                <div class="edit-field">
                  <input [(ngModel)]="editingClient.nom" placeholder="Nom">
                </div>
              </td>
              <td>
                <div class="edit-field">
                  <input [(ngModel)]="editingClient.prenom" placeholder="Prénom">
                </div>
              </td>
              <td>{{client.dateNaissance | date:'dd/MM/yyyy'}}</td>
              <td>
                <div class="edit-field">
                  <input [(ngModel)]="editingClient.adresse" placeholder="Adresse">
                </div>
              </td>
              <td>
                <div class="edit-field">
                  <input [(ngModel)]="editingClient.secteurActivite" placeholder="Secteur">
                </div>
              </td>
              <td>{{client.genre}}</td>
              <td>
                <div class="edit-field">
                  <input [(ngModel)]="editingClient.salaire" type="number" placeholder="Salaire">
                </div>
              </td>
              <td class="actions">
                <div class="action-buttons">
                  <button class="save-btn" (click)="updateClient()">
                    <i class="material-icons">save</i>
                    Sauvegarder
                  </button>
                  <button class="cancel-btn" (click)="cancelEdit()">
                    <i class="material-icons">close</i>
                    Annuler
                  </button>
                </div>
              </td>
            </ng-container>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>